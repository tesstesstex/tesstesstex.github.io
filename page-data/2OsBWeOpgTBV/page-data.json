{"componentChunkName":"component---src-templates-post-template-js","path":"/2OsBWeOpgTBV","result":{"data":{"microcmsArticles":{"id":"ba2df982-7d91-5dc5-8d6f-703c21fced41","articlesId":"2OsBWeOpgTBV","contents":"**:warning:この記事は2019/12/06 にQiita に投稿したものです**\n\n@murs313 さんの[Slackの雨通知botを爆速で作る【メッ●●】](https://qiita.com/murs13/items/abc2b124d53e2ed54a02)を読み、\n早速同じ物を作ろうと思いましたが、弊社はSlackが使えませんでした。\n\nというわけで**Hangouts Chat版**雨通知botを作ってみました。\nGASだと真似しすぎで作っててつまらないのでPythonとcronで実装してみました。\n\n※ なおHangouts ChatはG Suiteでのみ使用でき、個人のGoogleアカウントでは現在使用できません。\n\n# つくったもの\nテストで送信してみたものがこちら。\n実際は時間を合わせて17:00に送信されるように設定しています。\n![IMG_0068.jpg](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/342105/da93ccdf-2a24-c9dc-4b94-eb48a3689152.jpeg)\nHangouts ChatはMarkdownっぽい記法が使えるのが良いですね。\n（画像では強調表示がうまいこといってませんが……）\n\n# つかったもの\n- **CentOS 8**  \n  cronで定期実行します。\n- **Python 3.6.8**  \n- **Hangouts Chat の incoming webhook**\n- **[livedoorお天気API](http://weather.livedoor.com/weather_hacks/webservice)**\n\n# Hangouts ChatへのPOST\nHangouts Chat は incoming webhook が使用できます。\n@iitenkida7 さんの [[超簡単]Hangouts Chat の incoming webhooks を使ってAPIから簡単にメッセージを投稿する](https://qiita.com/iitenkida7/items/3c8f9f8f6ee1e809558d)を参考にさせて頂きました。\n\n# Pythonのソースコード\n```python:weather.py\nimport requests\n\nweather_url = 'http://weather.livedoor.com/forecast/webservice/json/v1?city=130010' # Tokyo\nresp = requests.get(weather_url)\ndata = resp.json()\n\n# 一部ぼかしていますがコピペでおk\nwebhook_url = \"https://chat.googleapis.com/v1/spaces/HOGEHOGE/messages?key={YOUR_KEY}&token={YOUR_TOKEN}\" \n\ntomorrow_weather = data['forecasts'][1]\ntelop = tomorrow_weather['telop']\nmax_temp = tomorrow_weather['temperature']['max']\nmin_temp = tomorrow_weather['temperature']['min']\nimage = tomorrow_weather['image']['url']\n\ntext = ''\ntext += '明日の天気は'\ntext += '*' + telop + '*'\ntext += 'です。\\n'\n# なぜかmaxとminが時々取得できない\nif max_temp is not None:\n    text += '最高気温'\n    text += max_temp.get('celsius')\n    text += '℃'\nif min_temp is not None:\n    text += '/最低気温'\n    text += min_temp.get('celsius')\n    text += '℃\\n'\ntext += image\n\ncontent = {\"text\": text}\nresponse = requests.post(webhook_url, json=content)\n```\n\n# cronの設定\ncronの設定は[こちら](https://eng-entrance.com/linux-command-crontab)が参考になると思います。\n\ncronの設定を行うには```crontab -e```を叩きましょう。\n\n```sh\n$ crontab -e\n```\n\nするとVimで設定ファイルが開くので、実行する時間と実行するコマンドを入力しましょう。\n今回はホームディレクトリ直下に置いたという設定です。\n\n```vim\n0 17 * * * python3 ~/weather.py\n```\n\nファイルを保存してVimを閉じた時に```crontab: installing new crontab```と表示されれば設定完了です。\n\n動作確認する場合は、再度```crontab -e```を開き、\n\n```vim\n*/1 * * * * python3 ~/weather.py\n```\n\nのように記述すれば1分おきにコマンドが実行されるようになります。\n\n# 感想\n参考にさせていただいたリンクがわかりやすかったので特に詰まることなく設定できました。\n","category":"Development","date":"2020-03-26T03:15:00.000Z","description":"Google Chat (旧名: Hangouts Chat) のbot を簡単に作る方法","tags":["Python 3"],"title":"Hangouts Chatの雨通知botを爆速で作る"}},"pageContext":{"slug":"2OsBWeOpgTBV"}},"staticQueryHashes":["2758407812","3827264240","825871152"]}